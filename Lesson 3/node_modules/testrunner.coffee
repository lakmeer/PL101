
printerr = require 'printerror'

tests   = []

printResults = (results, errors) ->
    if errors.length > 0
        console.log "\n #{results}  #{results.length - errors.length} tests passed, #{errors.length} failed.\n"
        for err in errors
            console.error "Failure on \"#{err.name }\""
            printerr err.err
    else
        console.log '\n' + results + "  " + results.length + " tests passed."


addTest = (name, fn) ->
    tests.push { name : name, testFn : fn }

addTest.run = ->

    results = []
    errors  = []

    for test in tests
        try
            test.testFn()
            results += "."

        catch e
            results += "!"
            errors.push { name : test.name, err : e }

    printResults results, errors

    # Reset for next run
    tests = []


module.exports = addTest
